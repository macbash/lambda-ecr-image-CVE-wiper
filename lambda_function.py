import json, boto3

client = boto3.client('ecr')

def lambda_handler(event, context):
    repo_name = event["detail"]["repository-name"]
    high_score = str(event["detail"]["finding-severity-counts"]['HIGH'])
    critical_score = str(event["detail"]["finding-severity-counts"]['CRITICAL'])
    Response_msg =  repo_name + ' Image_Tag:' + event["detail"]["image-tags"][0] + ' Scan Score:' + 'High:' + high_score + 'Critical:' + critical_score
    
    if int(event["detail"]["finding-severity-counts"]['HIGH']) > 0 or int(event["detail"]["finding-severity-counts"]['CRITICAL']) > 0:
       
        ecr_client_response = client.batch_delete_image( imageIds=[{'imageTag': event["detail"]["image-tags"][0],},],repositoryName=event["detail"]["repository-name"],)
        print (ecr_client_response)
        return 'Vulnerable Repo_name:' + Response_msg
    else:
        return 'Good Repo_name:' + Response_msg
    
